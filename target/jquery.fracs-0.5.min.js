(function(h){var b=function(n,m,l,k){this.left=Math.round(n);this.top=Math.round(m);this.width=Math.round(l);this.height=Math.round(k);this.right=n+l;this.bottom=m+k;this.equals=function(o){return this.left===o.left&&this.top===o.top&&this.width===o.width&&this.height===o.height};this.area=function(){return this.width*this.height};this.intersection=function(s){var u=Math.max(this.left,s.left);var q=Math.min(this.right,s.right);var t=Math.max(this.top,s.top);var p=Math.min(this.bottom,s.bottom);var r=q-u;var o=p-t;if(r<0||o<0){return undefined}return new b(u,t,r,o)}};var e=function(o,l,n,p,k,m){this.rects=o===undefined?undefined:{document:o,element:l,viewport:n};this.visible=p||0;this.viewport=k||0;this.possible=m||0;this.equals=function(q){return this.fracsEqual(q)&&this.rectsEqual(q)};this.fracsEqual=function(q){return this.visible===q.visible&&this.viewport===q.viewport&&this.possible===q.possible};this.rectsEqual=function(q){if(this.rects===undefined||q.rects===undefined){return this.rects===q.rects}return this.rects.document.equals(q.rects.document)&&this.rects.element.equals(q.rects.element)&&this.rects.viewport.equals(q.rects.viewport)}};var a=function(l,k){this.element=l;this.fracs=k;this.update=function(){var m=g.fracs(this.element);var n=this.fracs===undefined||!this.fracs.equals(m);this.fracs=m;return n}};var i=function(l){this.target=l;this.callbacks=[];this.prevFracs=undefined;this.bind=function(m){if(m!==undefined&&h.inArray(m,this.callbacks)===-1){this.callbacks.push(m)}};this.unbind=function(n){if(n===undefined){this.callbacks=[]}else{var m=h.inArray(n,this.callbacks);if(m>=0){this.callbacks.splice(m,1)}}};var k=this;this.check=function(){var m=g.fracs(g.rect(k.target),g.viewport());if(k.prevFracs===undefined||!k.prevFracs.equals(m)){h.each(k.callbacks,function(n,o){o.call(k.target,m,k.prevFracs)});k.prevFracs=m}}};var c=function(l,n,p){this.targets=[];this.callback=p;this.prevBest=undefined;this.property=n;for(var k in l){var o=l[k];if(o instanceof HTMLElement){this.targets.push(new a(o))}}var m=this;this.check=function(){var t=undefined;var r=g.viewport();for(var q in m.targets){var s=m.targets[q];s.update();if(t===undefined||s.fracs[m.property]>t.fracs[m.property]){t=s}}if(t.fracs[m.property]==0){t=undefined}if(m.prevBest!==t){m.callback.call(m,t,m.prevBest);m.prevBest=t}}};var j=function(l,k){if(!(l instanceof HTMLElement)||l.nodeName.toLowerCase()!=="canvas"){console.error("Outline needs a canvas but found: "+(l&&l.nodeName.toLowerCase()));return undefined}var n={crop:false,styles:[{selector:"header,footer,section,article",strokeWidth:undefined,strokeStyle:undefined,fillStyle:"rgb(230,230,230)"},{selector:"h1",strokeWidth:undefined,strokeStyle:undefined,fillStyle:"rgb(240,140,060)"},{selector:"h2",strokeWidth:undefined,strokeStyle:undefined,fillStyle:"rgb(200,100,100)"},{selector:"h3",strokeWidth:undefined,strokeStyle:undefined,fillStyle:"rgb(100,200,100)"},{selector:"h4",strokeWidth:undefined,strokeStyle:undefined,fillStyle:"rgb(100,100,200)"}]};this.settings=h.extend({},n,k);this.context=l.getContext("2d");this.$canvas=h(l);this.width=this.$canvas.attr("width");this.height=this.$canvas.attr("height");this.$window=h(window);this.$htmlBody=h("html,body");this.docRect;this.vpRect;this.scale;this.drag=false;var m=this;this.init=function(){var o=h.proxy(this.scroll,this);this.$canvas.css("cursor","pointer").mousedown(h.proxy(function(p){this.drag=true;this.scroll(p);this.$canvas.css("cursor","crosshair").addClass("dragOn");this.$htmlBody.css("cursor","crosshair");this.$window.bind("mousemove",o).one("mouseup",h.proxy(function(q){this.$canvas.css("cursor","pointer").removeClass("dragOn");this.$htmlBody.css("cursor","auto");this.$window.unbind("mousemove",o);this.drag=false;this.draw()},this))},this)).attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return false}});this.$window.bind("resize scroll",h.proxy(this.draw,this));this.draw()};this.applyStyles=function(o){for(idx in this.settings.styles){var q=this.settings.styles[idx];var p=h(q.selector);p.each(function(){m.drawElement(o,this,q.strokeWidth,q.strokeStyle,q.fillStyle)})}};this.drawElement=function(q,s,u,t,p){var o=h(s);var r=o.fracs("rect");u=u==="auto"?o.css("border-width"):u;t=t==="auto"?o.css("border-color"):t;p=p==="auto"?o.css("background-color"):p;this.drawRect(q,r,u,t,p)};this.drawRect=function(q,r,o,s,p){if(s!==undefined||p!==undefined){q.beginPath();q.rect(r.left,r.top,r.width,r.height);if(p!==undefined){q.fillStyle=p;q.fill()}if(s!==undefined){if(this.scale===undefined){q.lineWidth=o}else{q.lineWidth=o>0.2/this.scale?o:0.2/this.scale}q.strokeStyle=s;q.stroke()}}};this.draw=function(){this.docRect=h.fracs.document();this.vpRect=h.fracs.viewport();var p=this.width/this.docRect.width;var o=this.height/this.docRect.height;this.scale=p<o?p:o;if(this.settings.crop){this.$canvas.attr("width",this.docRect.width*this.scale).attr("height",this.docRect.height*this.scale)}this.context.clearRect(0,0,this.$canvas.width(),this.$canvas.height());this.context.scale(this.scale,this.scale);this.drawRect(this.context,this.docRect,1,"#000");this.applyStyles(this.context);if(this.drag===true){this.drawRect(this.context,this.vpRect,undefined,undefined,"rgba(228,77,38,0.6)")}else{this.drawRect(this.context,this.vpRect,undefined,undefined,"rgba(228,77,38,0.3)")}this.context.scale(1/this.scale,1/this.scale)};this.scroll=function(q){var p=this.$canvas.fracs("rect");var o=q.pageX-p.left;var s=q.pageY-p.top;h.fracs.scrollTo(o/this.scale-this.vpRect.width/2,s/this.scale-this.vpRect.height/2,100)};this.init()};var f="fracs";var g={document:function(){var k=h(document);return new b(0,0,k.width(),k.height())},viewport:function(){var k=h(window);return new b(k.scrollLeft(),k.scrollTop(),k.width(),k.height())},rect:function(l){var k=h(l);var m=k.offset();return new b(m.left,m.top,k.outerWidth(),k.outerHeight())},fracs:function(p,m){p=p instanceof HTMLElement?g.rect(p):p;m=m||g.viewport();var q=p.intersection(m);if(q===undefined){return new e()}var o=new b(q.left-p.left,q.top-p.top,q.width,q.height);var l=new b(q.left-m.left,q.top-m.top,q.width,q.height);var k=q.area();var n=Math.min(p.width,m.width)*Math.min(p.height,m.height);return new e(q,o,l,1*k/p.area(),1*k/m.area(),1*k/n)},round:function(l,k){if(isNaN(k)||k<=0){return Math.round(l)}return Math.round(l*Math.pow(10,k))/Math.pow(10,k)},scrollTo:function(m,l,k){k=k||1000;h("html,body").stop(true).animate({scrollLeft:m,scrollTop:l},k)}};var d={bind:function(k){return this.each(function(){var m=h(this);var l=m.data(f);if(l===undefined){l=new i(this);m.data(f,l);h(window).bind("scroll",l.check).bind("resize",l.check)}l.bind(k)})},unbind:function(k){return this.each(function(){var m=h(this);var l=m.data(f);if(l!==undefined){l.unbind(k);if(l.callbacks.length===0){m.removeData(f);h(window).unbind("scroll",l.check).unbind("resize",l.check)}}})},check:function(){return this.each(function(){var k=h(this).data(f);if(k){k.check()}})},fracs:function(){return g.fracs(g.rect(this.get(0)),g.viewport())},rect:function(){return g.rect(this.get(0))},max:function(m,o){if(o instanceof Function){var l=new c(this,m,o);h(window).bind("scroll",l.check).bind("resize",l.check);l.check();return this}else{if(h.inArray(m,["possible","visible","viewport"])>=0){var k=[];var n=undefined;this.each(function(){var p=h.fracs.fracs(this);if(n===undefined||p[m]>n){k=[this];n=p[m]}else{if(p[m]===n){k.push(this)}}});return h(k)}if(h.inArray(m,["width","height","left","right","top","bottom"])>=0){var k=[];var n=undefined;this.each(function(){var p=h.fracs.rect(this);if(n===undefined||p[m]>n){k=[this];n=p[m]}else{if(p[m]===n){k.push(this)}}});return h(k)}return this}},min:function(m){if(h.inArray(m,["possible","visible","viewport"])>=0){var l=[];var k=undefined;this.each(function(){var n=h.fracs.fracs(this);if(k===undefined||n[m]<k){l=[this];k=n[m]}else{if(n[m]===k){l.push(this)}}});return h(l)}if(h.inArray(m,["width","height","left","right","top","bottom"])>=0){var l=[];var k=undefined;this.each(function(){var n=h.fracs.rect(this);if(k===undefined||n[m]<k){l=[this];k=n[m]}else{if(n[m]===k){l.push(this)}}});return h(l)}return this},scrollTo:function(k,m,n){k=k||0;m=m||0;var l=g.rect(this.get(0));g.scrollTo(l.left-k,l.top-m,n);return this},softLink:function(k,l,m){return this.filter("a[href^=#]").each(function(){var o=h(this);var n=o.attr("href");o.click(function(){h(n).fracs("scrollTo",k,l,m)})})},outline:function(k){return this.each(function(){if(k==="redraw"){var l=h(this).data("outline");if(l!==undefined){l.draw()}}else{var l=new j(this,k);if(l!==undefined){h(this).data("outline",l)}}})}};h[f]=g;h.fn[f]=function(k){if(d[k]){return d[k].apply(this,Array.prototype.slice.call(arguments,1))}else{if(k===undefined){return d.fracs.apply(this,arguments)}else{if(k instanceof Function){return d.bind.apply(this,arguments)}else{h.error("Method "+k+" does not exist on jQuery."+f)}}}}})(jQuery);