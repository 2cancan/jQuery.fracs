(function(g){var b=function(m,l,k,j){this.left=Math.round(m);this.top=Math.round(l);this.width=Math.round(k);this.height=Math.round(j);this.right=m+k;this.bottom=l+j;this.equals=function(n){return this.left===n.left&&this.top===n.top&&this.width===n.width&&this.height===n.height};this.area=function(){return this.width*this.height};this.intersection=function(r){var t=Math.max(this.left,r.left);var p=Math.min(this.right,r.right);var s=Math.max(this.top,r.top);var o=Math.min(this.bottom,r.bottom);var q=p-t;var n=o-s;if(q<0||n<0){return undefined}return new b(t,s,q,n)}};var e=function(n,k,m,o,j,l){this.rects=n===undefined?undefined:{document:n,element:k,viewport:m};this.visible=o||0;this.viewport=j||0;this.possible=l||0;this.equals=function(p){return this.fracsEqual(p)&&this.rectsEqual(p)};this.fracsEqual=function(p){return this.visible===p.visible&&this.viewport===p.viewport&&this.possible===p.possible};this.rectsEqual=function(p){if(this.rects===undefined||p.rects===undefined){return this.rects===p.rects}return this.rects.document.equals(p.rects.document)&&this.rects.element.equals(p.rects.element)&&this.rects.viewport.equals(p.rects.viewport)}};var a=function(k,j){this.element=k;this.fracs=j;this.update=function(){var l=h.fracs(this.element);var m=this.fracs===undefined||!this.fracs.equals(l);this.fracs=l;return m}};var i=function(k){this.target=k;this.callbacks=[];this.prevFracs=undefined;this.bind=function(l){if(l!==undefined&&g.inArray(l,this.callbacks)===-1){this.callbacks.push(l)}};this.unbind=function(m){if(m===undefined){this.callbacks=[]}else{var l=g.inArray(m,this.callbacks);if(l>=0){this.callbacks.splice(l,1)}}};var j=this;this.check=function(){var l=h.fracs(h.rect(j.target),h.viewport());if(j.prevFracs===undefined||!j.prevFracs.equals(l)){g.each(j.callbacks,function(m,n){n.call(j.target,l,j.prevFracs)});j.prevFracs=l}}};var c=function(k,m,o){this.targets=[];this.callback=o;this.prevBest=undefined;this.property=m;for(var j in k){var n=k[j];if(n instanceof HTMLElement){this.targets.push(new a(n))}}var l=this;this.check=function(){var s=undefined;var q=h.viewport();for(var p in l.targets){var r=l.targets[p];r.update();if(s===undefined||r.fracs[l.property]>s.fracs[l.property]){s=r}}if(s.fracs[l.property]==0){s=undefined}if(l.prevBest!==s){l.callback.call(l,s,l.prevBest);l.prevBest=s}}};var f="fracs";var h={viewport:function(){var j=g(window);return new b(j.scrollLeft(),j.scrollTop(),j.width(),j.height())},rect:function(k){var j=g(k);var l=j.offset();return new b(l.left,l.top,j.outerWidth(),j.outerHeight())},fracs:function(o,l){o=o instanceof HTMLElement?h.rect(o):o;l=l||h.viewport();var p=o.intersection(l);if(p===undefined){return new e()}var n=new b(p.left-o.left,p.top-o.top,p.width,p.height);var k=new b(p.left-l.left,p.top-l.top,p.width,p.height);var j=p.area();var m=Math.min(o.width,l.width)*Math.min(o.height,l.height);return new e(p,n,k,1*j/o.area(),1*j/l.area(),1*j/m)},round:function(k,j){if(isNaN(j)||j<=0){return Math.round(k)}return Math.round(k*Math.pow(10,j))/Math.pow(10,j)},scrollTo:function(l,k,j){j=j||1000;g("html,body").stop(true).animate({scrollLeft:l,scrollTop:k},j)}};var d={bind:function(j){return this.each(function(){var l=g(this);var k=l.data(f);if(k===undefined){k=new i(this);l.data(f,k);g(window).bind("scroll",k.check).bind("resize",k.check)}k.bind(j)})},unbind:function(j){return this.each(function(){var l=g(this);var k=l.data(f);if(k!==undefined){k.unbind(j);if(k.callbacks.length===0){l.removeData(f);g(window).unbind("scroll",k.check).unbind("resize",k.check)}}})},check:function(){return this.each(function(){var j=g(this).data(f);if(j){j.check()}})},fracs:function(){return h.fracs(h.rect(this.get(0)),h.viewport())},rect:function(){return h.rect(this.get(0))},max:function(k,l){var j=new c(this,k,l);g(window).bind("scroll",j.check).bind("resize",j.check);j.check();return this},scrollTo:function(j,l,m){j=j||0;l=l||0;var k=h.rect(this.get(0));h.scrollTo(k.left-j,k.top-l,m);return this}};g[f]=h;g.fn[f]=function(j){if(d[j]){return d[j].apply(this,Array.prototype.slice.call(arguments,1))}else{if(j===undefined){return d.fracs.apply(this,arguments)}else{if(j instanceof Function){return d.bind.apply(this,arguments)}else{g.error("Method "+j+" does not exist on jQuery."+f)}}}}})(jQuery);