(function(h){var d=function(l,k,j,i){this.left=Math.round(l);this.top=Math.round(k);this.width=Math.round(j);this.height=Math.round(i);this.right=l+j;this.bottom=k+i;this.equals=function(m){return this.left===m.left&&this.top===m.top&&this.width===m.width&&this.height===m.height};this.area=function(){return this.width*this.height};this.intersection=function(q){var s=Math.max(this.left,q.left);var o=Math.min(this.right,q.right);var r=Math.max(this.top,q.top);var n=Math.min(this.bottom,q.bottom);var p=o-s;var m=n-r;if(p<0||m<0){return undefined}return new d(s,r,p,m)}};var g=function(m,j,l,n,i,k){this.rects=m===undefined?undefined:{document:m,element:j,viewport:l};this.visible=n||0;this.viewport=i||0;this.possible=k||0;this.equals=function(o){return this.fracsEqual(o)&&this.rectsEqual(o)};this.fracsEqual=function(o){return this.visible===o.visible&&this.viewport===o.viewport&&this.possible===o.possible};this.rectsEqual=function(o){if(this.rects===undefined||o.rects===undefined){return this.rects===o.rects}return this.rects.document.equals(o.rects.document)&&this.rects.element.equals(o.rects.element)&&this.rects.viewport.equals(o.rects.viewport)}};var a=function(j){this.target=j;this.callbacks=[];this.prevFracs=undefined;this.bind=function(k){if(k!==undefined&&h.inArray(k,this.callbacks)===-1){this.callbacks.push(k)}};this.unbind=function(l){if(l===undefined){this.callbacks=[]}else{var k=h.inArray(l,this.callbacks);if(k>=0){this.callbacks.splice(k,1)}}};var i=this;this.check=function(){var k=f.fracs(f.rect(i.target),f.viewport());if(i.prevFracs===undefined||!i.prevFracs.equals(k)){h.each(i.callbacks,function(l,m){m.call(i.target,k,i.prevFracs)});i.prevFracs=k}}};var c=function(j,l,n){this.targets=[];this.callback=n;this.prevBest=undefined;this.property=l;for(var i in j){var m=j[i];if(m instanceof HTMLElement){this.targets.push({element:m,fracs:undefined})}}var k=this;this.check=function(){var r=undefined;var p=f.viewport();for(var o in k.targets){var q=k.targets[o];q.fracs=f.fracs(q.element,p);if(r===undefined||q.fracs[k.property]>r.fracs[k.property]){r=q}}if(r.fracs[k.property]==0){r=undefined}if(k.prevBest!==r){k.callback.call(k,r,k.prevBest);k.prevBest=r}}};var e="fracs";var f={viewport:function(){var i=h(window);return new d(i.scrollLeft(),i.scrollTop(),i.width(),i.height())},rect:function(j){var i=h(j);var k=i.offset();return new d(k.left,k.top,i.outerWidth(),i.outerHeight())},fracs:function(n,k){n=n instanceof HTMLElement?f.rect(n):n;k=k||f.viewport();var o=n.intersection(k);if(o===undefined){return new g()}var m=new d(o.left-n.left,o.top-n.top,o.width,o.height);var j=new d(o.left-k.left,o.top-k.top,o.width,o.height);var i=o.area();var l=Math.min(n.width,k.width)*Math.min(n.height,k.height);return new g(o,m,j,1*i/n.area(),1*i/k.area(),1*i/l)},round:function(j,i){if(isNaN(i)||i<=0){return Math.round(j)}return Math.round(j*Math.pow(10,i))/Math.pow(10,i)}};var b={bind:function(i){return this.each(function(){var k=h(this);var j=k.data(e);if(j===undefined){j=new a(this);k.data(e,j);h(window).bind("scroll",j.check).bind("resize",j.check)}j.bind(i)})},unbind:function(i){return this.each(function(){var k=h(this);var j=k.data(e);if(j!==undefined){j.unbind(i);if(j.callbacks.length===0){k.removeData(e);h(window).unbind("scroll",j.check).unbind("resize",j.check)}}})},check:function(){return this.each(function(){var i=h(this).data(e);if(i){i.check()}})},fracs:function(){return f.fracs(f.rect(this.get(0)),f.viewport())},rect:function(){return f.rect(this.get(0))},max:function(j,k){var i=new c(this,j,k);h(window).bind("scroll",i.check).bind("resize",i.check);i.check();return this}};h[e]=f;h.fn[e]=function(i){if(b[i]){return b[i].apply(this,Array.prototype.slice.call(arguments,1))}else{if(i===undefined){return b.fracs.apply(this,arguments)}else{if(i instanceof Function){return b.bind.apply(this,arguments)}else{h.error("Method "+i+" does not exist on jQuery."+e)}}}}})(jQuery);